checkoutLocation: "./forknite"
workspaceLocation: "."
tasks:
  - name: setup
    init: |
      yarn create react-app forknite-pwa --template cra-template-pwa-typescript
      cd /workspace/forknite-pwa/src/
      mkdir modules && cd modules/
      mv /workspace/forknite/ ./
      touch modules_checkout
      echo "git clone https://github.com/etienne1911/forknite.git" >> modules_checkout
      echo "git clone https://github.com/etienne1911/pwa-tools.git" >> modules_checkout
      echo "git clone https://gitlab.com/three-modules/three-core-modules.git" >> modules_checkout
      echo "git clone https://gitlab.com/three-modules/three-resources.git" >> modules_checkout
      echo "git clone https://gitlab.com/three-modules/three-experiments.git" >> modules_checkout
      sh modules_checkout
      node --experimental-json-modules ./pwa-tools/scripts/create_submodules.mjs ./modules_checkout >> ../../.gitmodules
      rm modules_checkout && mv .gitmodules ../../
      cd /workspace/forknite-pwa/src/modules/three-experiments/ && git checkout -b voxels
      cd /workspace/forknite-pwa/
      yarn add react-router-dom react-router-dom three @types/three cannon-es &&
      yarn add sparse-octree @timohausmann/quadtree-js proj4 &&
      yarn add mousetrap @types/mousetrap
      node --experimental-json-modules ./src/modules/pwa-tools/scripts/patch_tsconf.mjs
      sed -i 's/.\/App/.\/modules\/forknite\//' src/index.tsx
    command: |
      cd /workspace/forknite-pwa
      yarn run start
ports:
  - port: 3000
    onOpen: ignore
